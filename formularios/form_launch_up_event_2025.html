<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Registro - Launch Up ACS UNMSM 2025</title>
 <!-- SweetAlert2 para pop-ups bonitos -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.7/dist/umd/supabase.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f4f6f9;
      margin: 0;
      padding: 0;
      color: #003366;
    }

    .container {
      max-width: 700px;
      margin: 40px auto;
      background-color: #FFFFFF;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
    }

    h1 {
      color: #0054A6;
      text-align: center;
      margin-bottom: 10px;
    }

    .intro {
      font-size: 14px;
      margin-bottom: 25px;
      line-height: 1.5;
    }

    label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
    }

    .required {
      color: red;
    }

    input, select {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 8px;
      box-sizing: border-box;
    }

    .social-links {
      margin: 10px 0 20px;
    }

    .social-links a {
      display: inline-block;
      margin-right: 10px;
      color: #0054A6;
      font-weight: bold;
      text-decoration: none;
    }

    button {
      background-color: #FFD400;
      color: #003366;
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      margin-top: 20px;
    }

    button:hover {
      background-color: #e5bc00;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Launch Up ACS UNMSM 2025</h1>
    <p class="intro">
      🎉 Te invitamos a ser parte del Launch Up del ACS UNMSM. Este evento marcará el inicio oficial de nuestro capítulo en la Universidad Nacional Mayor de San Marcos 🏛️ y reunirá a capítulos, asociaciones y redes estudiantiles con intereses comunes 🌐, creando un espacio para conectar 🤝, compartir ideas 💡 y fomentar la colaboración académica, científica y profesional 📚 ✨.
      <br><br>
      📅 <strong>Fecha:</strong> Viernes 23 de mayo<br>
      📍 <strong>Lugar:</strong> Auditorio de la Facultad de Química e Ingeniería Química – UNMSM<br>
      ⏰ <strong>Hora:</strong> 6:30 pm<br>
      📲 Para consultas: Diana Soto – 939 595 523
    </p>

        <form id="registration-form">
      <input type="hidden" name="event_name" value="Launch Up ACS UNMSM 2025">

      <label>Nombres y Apellidos <span class="required">*</span></label>
      <input name="full_name" required>

      <label>Correo electrónico <span class="required">*</span></label>
      <input name="email" type="email" required>

      <label>DNI o Carnet de extranjería <span class="required">*</span></label>
      <input name="id_document" 
      inputmode="numeric" 
      maxlength="20" 
      required  />

      <label>Organización / Universidad <span class="required">*</span></label>
      <input name="organization" required>

      <label>¿Cuál es tu puesto? (Si eres estudiante, indícalo) <span class="required">*</span></label>
      <input name="position" required>

      <label>Si eres estudiante, ¿cuál es tu carrera?</label>
      <input name="major">

      <label>Número de teléfono (WhatsApp) <span class="required">*</span></label>
      <input 
      name="phone_number" 
      pattern="\d{9}" 
      inputmode="numeric" 
      maxlength="9" 
      required 
      title="Debe ingresar exactamente 9 dígitos" />

      <label>¿Eres miembro del Student Chapter ACS UNMSM? <span class="required">*</span></label>
      <select name="is_member" required>
        <option value="">Selecciona</option>
        <option value="true">Sí</option>
        <option value="false">No</option>
      </select>

      <label>Si respondiste "Sí", indica tu Member ID (8 dígitos):</label>
      <input name="member_id" maxlength="8">

      <label>¿Autorizas el uso de tu imagen...? <span class="required">*</span></label>
      <select name="image_use_content" required>
        <option value="">Selecciona</option>
        <option value="true">Sí</option>
        <option value="false">No</option>
      </select>

      <div class="social-links">
        🌍 <a href="https://www.facebook.com/profile.php?id=61571451074801" target="_blank">Facebook</a>
        📸 <a href="https://www.instagram.com/acs.unmsm.pe/" target="_blank">Instagram</a>
        💼 <a href="https://www.linkedin.com/company/unmsmacs/" target="_blank">LinkedIn</a>
        💬 <a href="https://whatsapp.com/channel/0029Vb06ZVS42DcioR683m2J" target="_blank">Canal de WhatsApp</a>
      </div>

      <label>¿Nos sigues en redes sociales? <span class="required">*</span></label>
      <select name="following_social_media" required>
        <option value="">Selecciona</option>
        <option value="true">Sí</option>
        <option value="false">No</option>
      </select>

      <button type="submit">Enviar Registro</button>
    </form>
  </div>

  <div id="popup" class="popup" style="display: none;">
    <div id="popup-content" class="popup-content">
      <p id="popup-message"></p>
      <button onclick="document.getElementById('popup').style.display='none'">Cerrar</button>
    </div>
  </div>

  <script>
    const SUPABASE_URL = 'https://anmxgrjbltiduefiugva.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFubXhncmpibHRpZHVlZml1Z3ZhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg4MTQzMzQsImV4cCI6MjA2NDM5MDMzNH0.bASlmB95BuGXSLVTibjkfm7thjPolDrUxTM4fcr-1vk';
    const client = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
    const isStudentVariant = (value) => /estudiante|student/i.test(value.trim());

    const showError = (msg) => {
      Swal.fire({
        icon: 'error',
        title: 'Error de validación',
        text: msg,
        confirmButtonColor: '#0054A6'
      });
    };

    const showSuccess = () => {
      Swal.fire({
        icon: 'success',
        title: '¡Registro exitoso!',
        text: 'Gracias por registrarte. ¡Nos vemos en el evento!',
        confirmButtonColor: '#0054A6'
      });
    };

    document.getElementById('registration-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const form = e.target;
      const data = Object.fromEntries(new FormData(form));

      // Transformación
      data.is_member = data.is_member === "true";
      data.image_use_content = data.image_use_content === "true";
      data.following_social_media = data.following_social_media === "true";
      data.registered_at = new Date().toISOString();

      // Validaciones
      if (!data.email.includes('@')) return showError('El correo debe contener "@"');
      if (data.id_document.length > 20) return showError('DNI/Carnet no debe exceder los 20 caracteres');
      if (!/^\d{9}$/.test(data.phone_number)) return showError('Número de WhatsApp debe tener 9 dígitos');
      if (!data.following_social_media) return showError('Debes seguirnos en redes sociales para registrarte');

      if (data.is_member && !/^\d{8}$/.test(data.member_id || '')) {
        return showError('Debes ingresar tu Member ID de 8 dígitos si eres miembro del Student Chapter');
      }

      if (isStudentVariant(data.position) && (!data.major || data.major.trim() === '')) {
        return showError('Si eres estudiante, debes indicar tu carrera');
      }

      // Limpiar campos opcionales
      if (!data.member_id) data.member_id = null;
      if (!data.major) data.major = null;

      const { error } = await client
        .from('event_registrations')
        .insert([data]);

      if (error) return showError('Error al registrar: ' + error.message);

      form.reset();
      showSuccess();
    });
  </script>
</body>
</html>